<!-- èœå“è¯¦æƒ…é¡µé¢ -->
<view class="dish-detail-container" wx:if="{{dish}}">

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-container" wx:if="{{!dish}}">
  <text class="loading-text">åŠ è½½ä¸­...</text>
  <button class="test-btn" bindtap="testLoadDish">æµ‹è¯•åŠ è½½èœå“</button>
  <text class="test-info" wx:if="{{testDishId}}">æµ‹è¯•èœå“ID: {{testDishId}}</text>
</view>
  <!-- èœå“åŸºæœ¬ä¿¡æ¯ -->
  <view class="basic-info-section">
    <view class="dish-header">
      <view class="dish-image-placeholder">
        <text class="dish-text">{{dish.name}}</text>
      </view>
      <view class="dish-meta">
        <view class="dish-name-row">
          <text class="dish-name">{{dish.name}}</text>
          <view class="dish-status">
            <text class="status-badge {{dish.status}}">
              {{dish.status === 'available' ? 'å¯åˆ¶ä½œ' : dish.status === 'learning' ? 'å­¦ä¹ ä¸­' : 'æš‚åœä¾›åº”'}}
            </text>
          </view>
        </view>
        <text class="dish-description">{{dish.description}}</text>
        <view class="dish-stats">
          <view class="stat-item">
            <text class="stat-label">åˆ†ç±»</text>
            <text class="stat-value">
              {{dish.category === 'main' ? 'ä¸»é£Ÿ' : dish.category === 'soup' ? 'æ±¤ç±»' : dish.category === 'dessert' ? 'ç”œç‚¹' : dish.category === 'drink' ? 'é¥®æ–™' : 'å°åƒ'}}
            </text>
          </view>
          <view class="stat-item">
            <text class="stat-label">éš¾åº¦</text>
            <text class="stat-value">
              {{dish.difficulty === 'easy' ? 'ç®€å•' : dish.difficulty === 'medium' ? 'ä¸­ç­‰' : 'å¤æ‚'}}
            </text>
          </view>
          <view class="stat-item">
            <text class="stat-label">æ—¶é—´</text>
            <text class="stat-value">{{dish.prepTime}}åˆ†é’Ÿ</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">åˆ¶ä½œæ¬¡æ•°</text>
            <text class="stat-value">{{dish.cookCount}}æ¬¡</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¼–è¾‘æ¨¡å¼ -->
  <view class="edit-section" wx:if="{{isEditing}}">
    <view class="form-group">
      <text class="form-label">èœå“åç§°</text>
      <input
        class="form-input"
        value="{{editDish.name}}"
        bindinput="onEditInput"
        data-field="name"
      />
    </view>

    <view class="form-group">
      <text class="form-label">èœå“æè¿°</text>
      <textarea
        class="form-textarea"
        value="{{editDish.description}}"
        bindinput="onEditInput"
        data-field="description"
      />
    </view>

    <view class="form-row">
      <view class="form-group half-width">
        <text class="form-label">åˆ†ç±»</text>
        <picker
          class="form-picker"
          range="{{['ä¸»é£Ÿ', 'æ±¤ç±»', 'ç”œç‚¹', 'é¥®æ–™', 'å°åƒ']}}"
          value="{{['main', 'soup', 'dessert', 'drink', 'snack'].indexOf(editDish.category)}}"
          bindchange="onCategoryChange"
        >
          <view class="picker-text">
            {{editDish.category === 'main' ? 'ä¸»é£Ÿ' : editDish.category === 'soup' ? 'æ±¤ç±»' : editDish.category === 'dessert' ? 'ç”œç‚¹' : editDish.category === 'drink' ? 'é¥®æ–™' : 'å°åƒ'}}
          </view>
        </picker>
      </view>

      <view class="form-group half-width">
        <text class="form-label">éš¾åº¦</text>
        <picker
          class="form-picker"
          range="{{['ç®€å•', 'ä¸­ç­‰', 'å¤æ‚']}}"
          value="{{['easy', 'medium', 'hard'].indexOf(editDish.difficulty)}}"
          bindchange="onDifficultyChange"
        >
          <view class="picker-text">
            {{editDish.difficulty === 'easy' ? 'ç®€å•' : editDish.difficulty === 'medium' ? 'ä¸­ç­‰' : 'å¤æ‚'}}
          </view>
        </picker>
      </view>
    </view>

    <view class="form-row">
      <view class="form-group half-width">
        <text class="form-label">çŠ¶æ€</text>
        <picker
          class="form-picker"
          range="{{['å¯åˆ¶ä½œ', 'å­¦ä¹ ä¸­', 'æš‚åœä¾›åº”']}}"
          value="{{['available', 'learning', 'paused'].indexOf(editDish.status)}}"
          bindchange="onStatusChange"
        >
          <view class="picker-text">
            {{editDish.status === 'available' ? 'å¯åˆ¶ä½œ' : editDish.status === 'learning' ? 'å­¦ä¹ ä¸­' : 'æš‚åœä¾›åº”'}}
          </view>
        </picker>
      </view>

      <view class="form-group half-width">
        <text class="form-label">å‡†å¤‡æ—¶é—´(åˆ†é’Ÿ)</text>
        <input
          class="form-input"
          type="number"
          value="{{editDish.prepTime}}"
          bindinput="onEditInput"
          data-field="prepTime"
        />
      </view>
    </view>

    <view class="edit-actions">
      <button class="cancel-edit-btn" bindtap="cancelEdit">å–æ¶ˆ</button>
      <button class="save-edit-btn" bindtap="saveEdit">ä¿å­˜</button>
    </view>
  </view>

  <!-- é£Ÿææ¸…å• -->
  <view class="section" wx:if="{{dish.ingredients && dish.ingredients.length > 0}}">
    <view class="section-header">
      <text class="section-title">é£Ÿææ¸…å•</text>
    </view>
    <view class="ingredients-list">
      <view class="ingredient-item" wx:for="{{dish.ingredients}}" wx:key="index">
        <view class="ingredient-info">
          <text class="ingredient-name">{{item.name}}</text>
          <text class="ingredient-amount">{{item.amount}}</text>
        </view>
        <text class="ingredient-category">
          {{item.category === 'main' ? 'ä¸»æ–™' : item.category === 'side' ? 'è¾…æ–™' : 'è°ƒæ–™'}}
        </text>
      </view>
    </view>
  </view>

  <!-- åˆ¶ä½œæ­¥éª¤ -->
  <view class="section" wx:if="{{dish.steps && dish.steps.length > 0}}">
    <view class="section-header">
      <text class="section-title">åˆ¶ä½œæ­¥éª¤</text>
    </view>
    <view class="steps-list">
      <view class="step-item" wx:for="{{dish.steps}}" wx:key="index">
        <view class="step-number">{{index + 1}}</view>
        <view class="step-content">
          <text class="step-description">{{item.description}}</text>
          <text class="step-tip" wx:if="{{item.tip}}">ğŸ’¡ {{item.tip}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons" wx:if="{{!isEditing}}">
    <button class="add-to-cart-btn" bindtap="addToCart">åŠ å…¥èœå•</button>
    <view class="manage-buttons">
      <button class="edit-btn" bindtap="startEdit">ç¼–è¾‘</button>
      <button class="delete-btn" bindtap="deleteDish">åˆ é™¤</button>
    </view>
  </view>
</view>